"use strict";let eG=(a,b="")=>{return self[a]||b};let pV="Cloudflare",pE=()=>{},pP=true;(()=>{var u=eG("BACKENDS","").split(","),d=t=>{let n=[];return t.forEach(r=>{n.push({c:r.shortcode,u:r.url})}),n},p=async function(t,n){let r=new URL(t.url),c={lastIDs:{}},i=[];for(let s=0;s<u.length;s++){let o=u[s],h=`https://${o}/api/v1/timelines/public?local=true&only_media=false`;try{(await(await fetch(h)).json()).forEach(e=>{c.lastIDs[o]=e.id;let a={type:"post",server:o,app:{name:e?.application?.name||"Unknown",link:e?.application?.website||"about:blank"},user:{at:e.account.username,name:e.account.display_name,id:e.account.id,emoji:d(e.account.emojis),bot:e.account.bot,locked:e.account.locked,url:e.account.url},create:new Date(e.created_at).getTime(),post:e.content,emoji:d(e.emojis),favs:e.favourites_ount,boosts:e.reblogs_count,replies:e.replies_count,lang:e.language,cw:e.sensitive,cwt:e.spoiler_text,reach:e.visibility,url:e.url,media:e.media_attachments,refer:e.mentions,poll:e.poll};e.edited_at&&(a.edit=new Date(e.edited_at).getTime()),e.in_reply_to_id&&(a.reply=e.in_reply_to_id,a.replyTo=e.in_reply_to_account_id),i.push(a)})}catch(l){i.push({type:"error",create:Date.now(),server:o,stack:l.stack})}}return i.sort((s,o)=>Math.sign(o.create-s.create)),c.timeline=i,new Response(JSON.stringify(c),{headers:{"Content-Type":"application/json"}})};addEventListener("fetch",async function(t){let n=t.request,r=n.headers.get("cf-connecting-ip");t.respondWith(p(n,r))});})();
